# Test that we can start a program and stop it, and that
# the program gets an interrupt signal so it can shut down
# gracefully.
mkdir progdir
gopm -c gopmconfig --quit-delay 0 &
waitfile gopm.socket
waitfile progdir/started1.txt
waitfile progdir/started2.txt
gopmctl --addr unix:gopm.socket stop sleeper

# The sleeper process should be interrupted.
waitfile progdir/intr1.txt

# The other process should not.
! waitfile progdir/intr2.txt

gopmctl --addr unix:gopm.socket shutdown
wait

# The other process should have shut down cleanly in the end.
exists progdir/intr2.txt

-- gopmconfig/config.cue --
package config

grpc_server: {
	network: "unix"
	address: "gopm.socket"
}
programs: sleeper: {
	command: """
		interrupt-notify started1.txt intr1.txt
		"""
	directory: "progdir"
}
programs: unaffected: {
	command: """
		interrupt-notify started2.txt intr2.txt
		"""
	directory: "progdir"
}
