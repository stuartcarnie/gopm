# Test that we can start a program and stop it, and that
# the program gets an interrupt signal so it can shut down
# gracefully.
mkdir progdir
gopm -c gopmconfig --quit-delay 0 &
waitfile gopm.socket
waitfile progdir/started.txt
gopmctl --addr unix:gopm.socket stop sleeper
waitfile progdir/intr.txt
gopmctl --addr unix:gopm.socket shutdown
wait

-- gopmconfig/config.cue --
package config

grpc_server: {
	network: "unix"
	address: "gopm.socket"
}
programs: sleeper: {
	command: """
		interrupt-notify started.txt intr.txt
		"""
	directory: "progdir"
	stop_signals: ["INT"]
}
