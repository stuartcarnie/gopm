# Test that a configuration with cyclic dependencies is an error.

# Start it up. It should fail immediately with an error.
! gopm -c gopmconfig --quit-delay 0 &
wait
stderr 'Error loading configuration  	error:cycles detected in program dependencies: (\[a <= b <= a]|\[b <= a <= b])'

-- gopmconfig/config.cue --
package config

gopm: grpc_server: {
	network: "unix"
	address: "gopm.socket"
}
gopm: programs: {
	a: {
		command: " "
		depends_on: ["b", "c"]
	}
	b: {
		command: " "
		depends_on: ["d", "a"]
	}
	c: {
		command: " "
	}
	d: {
		command: " "
	}
}
