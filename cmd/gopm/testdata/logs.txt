gopm -c gopmconfig --quit-delay 0 &
waitfile gopm.socket
waitfile finished.txt
gopmctl --addr unix:gopm.socket logs -F -n 20 writer
cmp stdout expect-log-n-20
gopmctl --addr unix:gopm.socket logs -F -n 3 writer
cmp stdout expect-log-n-3

gopmctl --addr unix:gopm.socket shutdown
wait

-- gopmconfig/config.cue --
package config

config: grpc_server: {
	network: "unix"
	address: "gopm.socket"
}
config: programs: writer: {
	command: """
		echo something to stdout
		echo other thing to stderr >&2
		echo foo
		echo bar
		echo baz
		echo done > finished.txt
		"""
}
-- expect-log-n-20 --
something to stdout
other thing to stderr
foo
bar
baz
-- expect-log-n-3 --
foo
bar
baz
