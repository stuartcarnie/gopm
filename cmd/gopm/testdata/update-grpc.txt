# Test that we can listen on a new gRPC server.

# Start it up. Initial files should be created.
gopm -c gopmconfig --quit-delay 0 &
waitfile started.txt

# Reload the configuration with the new gRPC server address.
cp config2.cue gopmconfig/config.cue
gopmctl --addr unix:gopm.socket reload

# Shut down the server using the new address.
gopmctl --addr unix:gopm2.socket shutdown
wait

-- gopmconfig/config.cue --
package config

config: grpc_server: {
	network: "unix"
	address: "gopm.socket"
}
config: programs: sleeper: {
	command: "echo started > started.txt"
}

-- config2.cue --
package config

config: grpc_server: {
	network: "unix"
	address: "gopm2.socket"
}
